---
description: 設計ドキュメント間の一貫性をチェックし、要件・ドメインモデルとの整合性を検証するレビューワークフロー
auto_execution_mode: 1
---

# ReviewDesign (a-014)

## 目的

- 設計フェーズで作成されたすべてのドキュメント間の一貫性を体系的にチェックする。
- 設計ドキュメント間の不整合、漏れ、矛盾を検出し、修正提案を提供する。
- 技術選定、アーキテクチャ、データモデル、API仕様の整合性を確認する。
- レビュー結果レポートを作成し、修正すべき項目を優先度付きでリストアップする。

## 前提

- 要件・ドメインレビューが完了していること（`ReviewRequirementsDomain` (a-006) 実施済み）。
- 以下の設計ドキュメントが作成されていること：
  - `docs/project/design/01-tech-stack.md`
  - `docs/project/design/02-repository-structure.md`
  - `docs/project/design/03-screen-design.md`
  - `docs/project/design/04-data-model.md`
  - `docs/project/design/05-api-spec.md`
  - `docs/project/design/06-architecture.md`
  - `docs/project/design/07-infrastructure.md`

## 手順

### 1. ドキュメント存在確認

- 必要なすべての設計ドキュメントが存在するか確認する：
  ```bash
  ls -l docs/project/design/*.md
  ```
- 不足しているドキュメントがある場合、対応するワークフローの実行を促す。

### 2. 一貫性チェックの実行

以下の項目について、自動検索（grep等）と手動確認を組み合わせて検証する。

#### 2.1 テックスタック ↔ アーキテクチャ
- **整合性**: 選定された技術（01-tech-stack.md）がアーキテクチャ図（06-architecture.md）のコンポーネントと一致しているか。
- **ADR**: 重要な技術選定理由がADRとして記録されているか。

#### 2.2 データモデル ↔ ドメインモデル
- **カバレッジ**: ドメインモデルのAggregate（01-domain-model.md）がデータモデル（04-data-model.md）のエンティティとして定義されているか。
- **用語統一**: テーブル名やカラム名がユビキタス言語と一致しているか。

#### 2.3 API仕様 ↔ データモデル
- **リソース**: APIリソース（05-api-spec.md）がデータモデルのエンティティに基づいているか。
- **フィールド**: APIのレスポンスフィールドがデータモデルに存在するか。

#### 2.4 画面設計 ↔ API仕様
- **カバレッジ**: 画面（03-screen-design.md）で必要なデータ取得・操作がAPIエンドポイントとして定義されているか。
- **状態**: エラー状態やロード状態に対応するレスポンス仕様があるか。

#### 2.5 インフラ ↔ アーキテクチャ
- **構成**: インフラ構成（07-infrastructure.md）がアーキテクチャ図のコンポーネントを網羅しているか。
- **非機能要件**: 可用性やセキュリティ要件がインフラ設計に反映されているか。

### 3. レビュー結果レポートの作成

- 検出された問題（Error/Warning）をまとめ、`docs/project/DESIGN-REVIEW-REPORT.md` を作成する。

**レポートフォーマット例**:
```markdown
# 設計ドキュメント一貫性レビュー結果
**実施日**: YYYY-MM-DD

## サマリー
- ✅ OK: X項目
- ⚠️ Warning: X項目
- ❌ Error: X項目

## 詳細

### 1. テックスタック ↔ アーキテクチャ
- ✅ OK: 選定技術はアーキテクチャパターンに適合しています。

### 2. データモデル ↔ ドメインモデル
- ❌ **Error**: Aggregate「Order」に対応するテーブル定義が見つかりません。

### 3. API仕様 ↔ データモデル
- ⚠️ **Warning**: APIレスポンスのフィールド `user_rank` がデータモデルにありません。

### 4. 画面設計 ↔ API仕様
- ❌ **Error**: 「注文履歴画面」に必要な `GET /api/orders/history` が定義されていません。

### 5. インフラ ↔ アーキテクチャ
- ✅ OK: 冗長化構成はアーキテクチャの可用性要件を満たしています。

## 推奨アクション
1. `DefineDataModel` (a-010) で `orders` テーブルを定義する。
2. `DefineAPISpec` (a-011) で `GET /api/orders/history` を追加する。
```

### 4. 結果の報告と修正提案

- ユーザーにレポートの内容を要約して伝える。
- 重大なエラー（❌）がある場合は、優先的に修正することを提案する。
- 「修正作業を開始しますか？それともレポートをGitに保存して終了しますか？」

### 5. Git への追加（オプション）

- ユーザーが希望する場合、レポートをコミットする。
  ```bash
  git add docs/project/DESIGN-REVIEW-REPORT.md
  git commit -m "docs: 設計整合性レビューレポートの作成"
  ```

## 完了条件

- `docs/project/DESIGN-REVIEW-REPORT-YYYYMMDDHHMMSS.md` が作成されている。
- 全設計ドキュメント間の整合性がチェックされ、結果（OK/Warning/Error）が記録されている。
- 具体的な修正アクションが提案されている。

## エスカレーション

- 致命的な不整合がある場合：
  - 「データモデルとAPI仕様の間に大きな乖離があります。実装手戻りを防ぐため、設計の見直しを強く推奨します。」
- ドメインモデルとの乖離がある場合：
  - 「設計がドメインモデルの意図を反映していません。ビジネスロジックの破綻につながる恐れがあります。」