---
description: ユーザーストーリーとインタビューからタスク定義ドキュメントを作成し、目的・変更内容・受け入れ基準を明確化するワークフロー
---

# CreateTaskDefinition (b-002)

## 目的

- 新しいタスクの背景・目的・スコープを明確化する。
- ユーザーストーリーと変更内容を整理し、後続のリサーチ・実装計画に渡す。
- 測定可能な受け入れ基準を定義し、完了条件を共有する。

## 前提

- `docs/tasks/task{ID}-{SLUG}/` が `CreateTaskDirectory (b-001)` で作成済みであること。
- テンプレート: `.windsurf/templates/tasks/task-template/a-definition.md`
- タスクの概要が関係者と共有済みであること。

## 手順

### 1. タスクディレクトリとテンプレートの確認

1. タスク候補を一覧し、作業対象を特定する。
   ```bash
   ls -d docs/tasks/task*
   ```
2. テンプレートが未配置の場合はコピーする。
   ```bash
   cp ".windsurf/templates/tasks/task-template/a-definition.md" \
      "docs/tasks/task{ID}-{SLUG}/a-definition.md"
   ```

### 2. 目的・背景のヒアリング

- 以下をユーザーまたは依頼者に確認し、メモを取る。
  - 「現状の課題・不具合は何か？」
  - 「誰が困っているのか？（ユーザー/開発/運用など）」
  - 「このタスクが完了すると、どのような価値・KPI 改善があるか？」
- 数値・頻度・Before/After を含め、具体的に記載する。

### 3. ユーザーストーリーの整理

- ペルソナごとにストーリーを作成。
  - 形式: 「[役割]として、[目的]がしたい。なぜなら[理由]だから」
  - 参考質問: 「このタスクで誰が何を達成したいですか？」「その理由は？」
- 優先度や関連するストーリーID（US-001 など）を付与すると後続管理が容易。

### 4. 変更内容の洗い出し

- タスク定義を実現するために必要な変更箇所をカテゴリ別に列挙。
  - 画面/UI（例: 新規ページ、既存フォームの項目追加）
  - API/サービス（例: 新規エンドポイント、仕様変更）
  - データモデル/DB（例: テーブル追加、カラム変更、インデックス）
  - その他（設定、翻訳、ドキュメント更新など）
- 可能な限りファイル名・エンドポイント・テーブル名など具体名を記載。

### 5. 受け入れ基準の策定

- 「完了」を判定できる観点を整理。
  - 正常系（期待する操作が成功する）
  - 異常系・エラー表示（入力エラー、権限不足など）
  - 性能・セキュリティ（応答時間、認可/認証、暗号化など）
  - テスト要件（ユニット/統合/E2E、ログ出力、監視アラート）
- 例: 「メール認証リンクは1回のみ有効」「API レスポンスは200ms以内」「CSRF トークン必須」

### 6. ドキュメントへの反映

1. `docs/tasks/task{ID}-{SLUG}/a-definition.md` を編集し、以下を順に埋める。
   - 目的・背景
   - ユーザーストーリー一覧
   - 変更内容一覧
   - 受け入れ基準
   - メモ/補足情報（関連Issue・制約等）
2. HTMLコメントは削除せず残す（テンプレートのガイドとして利用）。

### 7. 構造チェック

```bash
# セクション存在確認
grep "## 目的" docs/tasks/task{ID}-{SLUG}/a-definition.md \
  && grep "## ユーザーストーリー" docs/tasks/task{ID}-{SLUG}/a-definition.md \
  && grep "## 変更内容" docs/tasks/task{ID}-{SLUG}/a-definition.md \
  && grep "## 受け入れ基準" docs/tasks/task{ID}-{SLUG}/a-definition.md \
  && echo "OK" || echo "MISSING SECTION"
```

チェックリスト:
- [ ] 目的に数値/Before-Afterが含まれている
- [ ] すべての重要なユーザーストーリーが列挙されている
- [ ] 変更箇所がファイル名やエンドポイント単位で特定されている
- [ ] 受け入れ基準がテスト可能な表現になっている

### 8. Git への追加（任意）

```bash
git add docs/tasks/task{ID}-{SLUG}/a-definition.md
git commit -m "docs(task): タスク定義書の作成 task{ID}"
```
- テンプレートに従い、以下を記載：
  - **目的**（解決する問題、提供する価値）
  - **ユーザーストーリー一覧**（ストーリーID、ストーリー）
  - **変更内容一覧**（カテゴリ、変更内容）
  - **受け入れ基準**（正常系、異常系、エッジケース、テスト、パフォーマンス、セキュリティ）
  - **メモ**（補足情報）

- **HTMLコメントは削除せず残す**

### 8. レビューと確認

- 作成したドキュメントをユーザーに提示：
  - 「タスク定義ドキュメントが完成しました。内容を確認してください。」
  - 「目的は明確ですか？」
  - 「変更内容は網羅されていますか？」
  - 「受け入れ基準は具体的で測定可能ですか？」

### 9. 完成と次のステップ

- タスクディレクトリ内の `a-definition.md` が保存されたことを確認
- 例: `docs/tasks/task000001-email-verification/a-definition.md`

- 次のステップを提案：
  - 「タスク定義が完了しました。次はリサーチドキュメントを作成しますか？（`/b-002-CreateTaskResearch`）」

## 完了条件

- タスクディレクトリ内に `a-definition.md` が作成されている
- 例: `docs/tasks/task000001-{スラッグ}/a-definition.md`
- 以下のセクションがすべて記載されている：
  - 目的（解決する問題、提供する価値）
  - ユーザーストーリー一覧（最低1個以上）
  - 変更内容一覧（該当するカテゴリがすべて含まれている）
  - 受け入れ基準（正常系、異常系、テスト要件）
- 目的が具体的で測定可能である
- ユーザーストーリーが「[役割]として、[目的]がしたい、なぜなら[理由]」形式で記載されている
- 変更内容が具体的なファイル名やコンポーネント名を含んでいる
- 受け入れ基準が具体的で測定可能である
- ユーザーが内容を確認し、承認している

## エスカレーション

- タスクの目的が曖昧な場合：
  - 「タスクの目的が曖昧です。具体的な問題と解決後の状態を明確にしてください。」
  - 追加の質問で深掘り

- 変更内容が不明確な場合：
  - 「変更内容が抽象的すぎます。具体的なファイル名、コンポーネント名、カラム名を含めてください。」

- 受け入れ基準が曖昧な場合：
  - 「受け入れ基準が曖昧です。テスト可能な基準を定義してください。」
  - 例：「使いやすい」→「登録完了まで3クリック以内」

- ユーザーストーリーが技術的すぎる場合：
  - 「ユーザーストーリーが技術的すぎます。ユーザー視点の価値を記載してください。」
  - 例：「React Hook Form を使用したい」→「入力エラーを即座に確認したい」

- タスクのスコープが大きすぎる場合：
  - 「このタスクは範囲が広すぎます。複数のタスクに分割することを推奨します。」
  - 1タスクは1-5日で完了できる粒度が理想

- 受け入れ基準にセキュリティ要件が欠けている場合：
  - 「セキュリティに関する受け入れ基準が不足しています。以下を検討してください：」
    - 入力バリデーション
    - XSS、CSRF、SQL Injection 対策
    - 認証・認可
    - データの暗号化
